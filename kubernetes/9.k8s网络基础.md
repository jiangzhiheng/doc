一、`Flannel`网络插件

1. `Kubetnetes`网络模型

   - 容器间通信：同一个`pod`内的多个容器间通信，`lo`
   - `Pod`通信：`Pod IP <--->Pod IP`
   - `Pod`与`service`通信：`Pod IP <--->Cluster IP`，通过`iptables`或`ipvs`规则
   - `Service`与集群外部客户端通信，`NodePort`或`Ingress`

2. 常见`CNI`网络插件

   - `Flannel`
   - `calico`
   - `canel`
   - `kube-router`

   实现方案：

   - 虚拟网桥
   - 多路复用：`MacVlan`
   - 硬件交换：`SR-IOV`

3. `Flannel`支持的后端通信模型

   - `VxLAN`
     - `vxlan`
     - `Directrouting`
   - `host-gw`：`host-gateway`
   - `UDP`

4. `Flannel`使用及配置

   1. `Flannel`运行方式

      以`daemonset`的方式运行在每个拥有`kubelet`的节点上

      ```shell
      kubectl get daemonset -n kube-system
      ```

   2. `Flannel`的配置文件

      ```shell
      kubectl get configmap -n kube-system
      kubectl describe configmap kube-flannel-cfg -n kube-system
      ```

      ```json
      // 主要修改的是以下部分
      net-conf.json:
      ----
      {
        "Network": "10.244.0.0/16",
        "Backend": {
          "Type": "vxlan",
          "Directrouting": true
        }
      }
      
      Events:  <none>
      ```

   3. `Flannel`的配置参数

      - `Network`：`flannel`使用的`CIDR`格式的网络地址，用于为`pod`配置网络功能
      - `SubnetLen`：用于把`Network`切分子网供各节点使用时，使用多长的掩码进行切分，默认为24位
      - `SubnetMin`：
      - `SubnetMax`
      - `Backend`：`vxlan,host-gw,udp`

   4. 配置方式：

      - 部署`flannel`之前修改`flannel`的`manifest`配置文件

        `kubectl apply -f kube-flannel.yml`

      - 编辑`configmap`

        `kubectl edit configmap kube-flannel-cfg -n kube-system`

二、基于`calico`实现网络策略

​        

​      

