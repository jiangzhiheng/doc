一、`Node`的管理

1. `Node`的隔离与恢复

   - 在硬件升级或硬件维护情况，我们需要将`Node`隔离，使其脱离集群的调度范围

     - 方式一：

       ```yaml
       apiVersion: v1
       kind: Node
       metadata:
         name: node01.jzh.com
         labels:
           kubernetes.io/hostname: node01.jzh.com
       spec:
         unschedulable: true
       # 通过kubectl replace完成对Node状态的修改
       # kubectl replace -f unschedule_node.yaml
       ```

     - 方式二：

       `kubectl patch  node  node01.jzh.com -p '{"spec":{"unschedulable":true}}'`

       注意：将某个`Node`脱离调度范围时，在其上运行的`Pod`并不会自动停止，需要手动停止

     - 方式三

       `kubectl cordon node01.jzh.com`

       `kubectl uncordon node01.jzh.com`

2. `Node`的扩容

二、更新资源对象的`Label`

- 给已创建的`Pod`添加一个标签

  `kubectl label pod redis-master-pod role=backend`

- 删除一个`Label`，`Label`的`key`后加一个减号即可

  `kubectl label pod redis-master-pod role-`

- 修改一个已存在的`label`,需要加`--overwrite`参数

  `kubectl label pod redis-master-pod role=master --overwrite`

三、`Namespace`：集群环境共享与隔离

1. 创建名称空间

   `kubectl create namespace prod`

2. 定义`Context`（运行空间）

   ```shell
   # 定义ns
   kubectl create ns prod
   kubectl create ns dev
   # 定义context
   kubectl config set-context ctx-dev --namespace=dev --cluster=kubernetes --user=dev
   kubectl config set-context ctx-prod --namespace=prod --cluster=kubernetes --user=prod
   ```

3. 设置工作组在特定的`Context`环境下工作

   - 设置运行环境

     `kubectl config use-context ctx-dev`

   - 在该环境下创建的`Pod`默认会在`dev`名称空间下。

四、`Kubernetes`资源管理

1. 计算资源管理

   - `Request`和`limit`参数
   - 基于`Request`和`Limit`的调度机制
   - 对大页内存的支持

2. 资源配置范围管理（`LimitRange`）

   - 创建一个`Namespace`

     `kubectl create namespace limit-example`

   - 为`Namespace`设置`LimitRange`

     ```yaml
     apiVersion: v1
     kind: LimitRange
     metadata:
       name: mylimits
     spec:
       limits:
       - type: Pod
         max:
           cpu: "4"
           memory: 2Gi
         min:
           cpu: 200m
           memory: 6Mi
         maxLimitRequestRatio:
           cpu: 3
           memory: 2
       - type: Container
         default:
           cpu: 300m
           memory: 200Mi
         defaultRequest:
           cpu: 200m
           memory: 100Mi
         max:
           cpu: "2"
           memory: 1Gi
         min:
           cpu: 100m
           memory: 3Mi
         maxLimitRequestRatio:
           cpu: 5
           memory: 4
     # kubectl create -f limitrange.yaml --namespace=limit-example
     [root@master clusterMgr]# kubectl get limits --namespace=limit-example
     NAME       CREATED AT
     mylimits   2020-04-15T10:26:12Z
     [root@master clusterMgr]# kubectl describe limits mylimits --namespace=limit-example
     Name:       mylimits
     Namespace:  default
     Type        Resource  Min   Max  Default Request  Default Limit  Max Limit/Request Ratio
     ----        --------  ---   ---  ---------------  -------------  -----------------------
     Pod         cpu       200m  4    -                -              3
     Pod         memory    6Mi   2Gi  -                -              2
     Container   cpu       100m  2    200m             200m           5
     Container   memory    3Mi   1Gi  100Mi            200Mi          4
     
     ```

     - 不论是`CPU`还是内存，在`LimitRange`中，`Pod`和`Container`都可以设置`Min,Max和Max Limit/Request Ratio`参数，`Container`还可设置`Default Request`和`Default Limit`
     - `Limit/Request Ratio`参数限制了`Pod`中所有容器的`Limits`值与`Request`值的比例上限。
     - 如果设置了`Container`的`Max`，那么对于该类资源而言，整个集群中的所有容器都必须设置`Limits`，否则无法成功创建。`Pod`内的容器未配置`limits`时，将使用`Default Limit`的值。
     - 如果设置了`Container`的`Min`，那么对于该类资源而言，整个集群中的所有容器都必须设置`Request`。
     - `Pod`内的任何容器的`Limit`与`Requests`的比例都不能超过`Container`的`Limit/Request Ratio`

3. 资源服务质量管理（`Resource QoS`）

   - `Kubernetes`中`Pod`的`Requests`和`Limits`资源配置有如下特点
     - 如果`Pod`配置的`Request`值等于`Limit`值，那么该`Pod`获得的资源是完全可靠的。
     - 如果`Pod`的`Request`值小于`Limit`值，那么该`Pod`获得的资源可分为两部分：
       - 完全可靠的值，资源量大小等于`Requests`值。
       - 不可靠的资源，资源量的大小等于`Limits`与`Requests`的差额。
   - 服务质量等级：
     - `Guaranteed`：`Pod`中的容器对所有资源类型都定义了`Limits`和`Requests`，并且所有容器的`Limits`值都和`Requests`相等，这种情况下，容器可以不定义`Requests`，只定义`limits`。
     - `BestEfford`：`Pod`中所有容器都未定义资源配置。
     - `Burstable`：介于以上两种之间。
   - `Kubernetes QoS`的工作特点
   - `OOM`计分系统

4. 资源配额管理