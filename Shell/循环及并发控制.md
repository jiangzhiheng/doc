1. for循环

   for  变量名 [in 取值列表]

   do

   ​		循环体

   done

   1. 示例1：批量主机ping测试

      ```shell
      #!/bin/bash
      #ping check
      
      >ip.txt
      
      for i in {2..254}
      #for ip in `cat ip.txt`    #ip地址列表从ip.txt文件中读取
      do
              {
              ip=192.168.1.$i
              ping -c1 -w1 $ip &>/dev/null  #-w1  指定超时时间
              if [ $? -eq 0 ];then
                      echo "$ip is up"|tee -a ip.txt
              fi
              }&  #放到后台执行
      done
      wait   #等待之前所有的后台进程结束
      echo "finished..
      ```

   2. 示例2：批量创建用户  (通过手动输入prefix以及密码创建)

      ```shell
      #!/bin/bash
      #create user 
      
      read -p "Please enter prefix & password & num[test 123 5]" prefix pass num
      printf "user information:
      ------------------------------
      user prefix:    $prefix
      user password:  $pass
      user num:       $num
      ------------------------------
      "
      read -p "Are you sure?[y/n]" action
      if [ "$action" != "y" ];then
              exit 1
      fi
      
      for i in `seq -w $num`
      do
              user=$prefix$i
              id $user &>/dev/null
              if [ $? -eq 0 ];then
                      echo "user $user already exists"
              else
                      useradd $user
                      echo $pass |passwd --stdin $user&>/dev/null
                      if [ $? -eq 0 ];then
                              echo "$user is created."
                      fi
              fi
      done
      
      ```

   3. 批量创建用户（通过提供用户名密码清单文件来创建）

      ```shell
      #!/bin/bash
      #create user by read userlist file
      #
      #userlist format
      #	user1   passwd1
      #	user2	passwd2
      #	user3	passwd3
      #	.....
      
      
      
      if [ $# -eq 0 ];then
      	echo "usage:`basename $0` file"
      	exit 1
      fi
      
      if [ ! -f $1 ];then
      	echo "error file"
      	exit 2
      fi
      
      #希望for处理文件按照回车分隔，而不是空格或者tab空格
      #重新定义分隔符为回车 \n
      #IFS内部字段分隔符
      IFS=$'\n'
      
      for line in `cat $1`
      do
      	if [ ${#line} -eq 0 ];then
      		continue
      	fi
      	user=`echo $line|awk '{print $1}'`
      	pass=`echo $line|awk '{print $2}'`
      	id $user &>/dev/null
              if [ $? -eq 0 ];then
                      echo "user $user already exists"
              else
                      useradd $user
                      echo $pass |passwd --stdin $user&>/dev/null
                      if [ $? -eq 0 ];then
                              echo "$user is created."
                      fi
              fi
      
      done
      ```

2. expect解决脚本中交互问题

   1. expect实现ssh非交互登录

      安装expect:

      ` #yum -y install expect`

      `# vim expect_ssh01.sh`

      expect脚本解决交互问题示例：（1，2，3）

      ```shell
      #!/usr/bin/expect
      spawn ssh root@192.168.1.130   #启动一个expect会话
      
      expect {
              "yes/no" { send "yes\r"; exp_continue }
              "password:" { send "PASSWORD\r" };
      }
      interact
      ```

      ```shell
      #!/usr/bin/expect
      set ip 192.168.1.129
      set user root
      set password PASSWORD
      set timeout 5
      spawn ssh $user@$ip
      
      expect {
              "yes/no" { send "yes\r"; exp_continue }
              "password:" { send "$password\r" };
      }
      interact
      ```

      ```shell
      #!/usr/bin/expect
      set ip [lindex $argv 0]  #位置参数1
      set user [lindex $argv 1]  #位置参数2
      set password PASSWORD 
      set timeout 5
      spawn ssh $user@$ip
      
      expect {
              "yes/no" { send "yes\r"; exp_continue }
              "password:" { send "$password\r" };
      }
      #interact #进入交互模式
      expect "#"
      send "useradd test\r"
      send "exit\r"
      expect eof #结束expect
      ```

   2. expect实现scp非交互传输文件

      ```shell
      #!/usr/bin/expect
      set ip [lindex $argv 0]  
      set user [lindex $argv 1]
      set password PASSWORD 
      set timeout 5
      spawn scp -r /etc/hosts $user@$ip:/etc
      
      expect {
              "yes/no" { send "yes\r"; exp_continue }
              "password:" { send "$password\r" };
      }
      expect eof
      ```

   3. expect实现批量主机公钥推送

      ```shell
      #!/bin/bash
      #
      >ip.txt
      password=PASSWORD
      
      rpm -ql expect &>/dev/null
      if [ $? -eq 0 ];then
      	yum -y install expect &>/dev/null
      fi
      if [ ! -f ~/.ssh/id_rsa ];then
      	ssh-keygen -P "" -f ~/.ssh/id_rsa
      fi
      
      for i in {3..254}
      do
      	{
      	ip=192.168.1.$i
      	ping -c1 -w1 $ip &>/dev/null
      	if [ $? -eq 0 ];then
      		echo "$ip" >> ip.txt
      		/usr/bin/expect <<-EOF
      		set timeout 15
      		spawn ssh-copy-id  $ip
      		expect {
      			"yes/no" { send "yes\r"; exp_continue }
      			"password:" { send "$password\r" }
      		}
      		expect eof
      		EOF
      	fi	
      	}&
      done
      wait
      echo "finished"
      ```

3. 