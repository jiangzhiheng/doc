一、 `Docker`中的镜像

1. `Docker`镜像介绍

   `image`时`DOcker`术语的一种，对于容器而言，它代表一个只读的`layer`，而`layer`则具体代表`Docker`容器文件系统中可叠加的一部分

2. `rootfs`

   - `rootfs`代表一个`Docker`容器在启动时(而非运行后)其内部可见的文件系统视角，或者`Docker`容器的根目录，当然，该目录下含有`Docker`容器所需要的系统文件、goon根据、容器文件等
   - 传统上，`Linux`操作系统内核启动时，内核会首先挂载一个只读(`read-only`)的`rootfs`，当系统检测其完整性后，决定是否将其切换为读写模式，或者最后在`rootfs`之上另行挂载一种文件系统并忽略`rootfs`
   - 当`Docker Daemon`为`Docker`容器挂载`rootfs`的时候，与传统`Linux`内核类似，将其设定为只读模式，在`rootfs`挂载完之后，利用`Union Mount`技术，在这个只读的`rootfs`之上再挂载一个读写的文件系统
   - 容器虽然只有一个文件系统，但该文件系统由“两层”组成，分别为读写文件系统和只读文件系统

3. `Union Mount`

   - `Union Mount`代表一种文件系统挂载方式，允许同一时刻多种文件系统叠加挂载在一起，并以一种文件系统的形式，呈现多种文件系统内容合并后的目录
   - 一般情况下，若通过某种文件系统挂载内容至挂载点，挂载点目录中原先的内容会被隐藏，而`Union Mount`则不会将挂载点目录中的内容隐藏，反而是将挂载点目录中的内容和被挂载的内容合并，并为合并后的内容提供一个统一独立的文件系统视角
   - 实现这种`Union Mount`技术的文件系统一般称为联合文件系统(`Union FileSystem`)，较为常见的由`UnionFS,aufs,OverlatFS`
   - `aufs`的`COW(copy-on-write)`特性：如果用户要修改`roofs`中某文件的内容，而`rootfs`在内核层面是只读的，则会将该文件复制到读写文件系统中然后再对该文件进行操作，并在用户视角中只能看到更新后的内容

4. `image`

   - 简单来说`image`就是`Docker`容器中只读文件系统`rootfs`的一部分。换言之，实际上`Docker`容器的`rootfs`可以由多个`image`来构成，多个`image`构成的`rootfs`的方式依然沿用`Union Mount`技术
   - 父镜像和基础镜像

5. `layer`

   - 容器镜像的`rootfs`是容器只读的文件系统，`rootfs`又由多个只读的`image`构成。于是，`rootfs`中的每个只读的`image`都可以称之为一个`layer`
   - `top layer`：`Docker Daemon`在创建容器时会在容器的`rootfs`之上，再挂载一层读写文件系统，这层文件系统也称为容器的一个`layer`
   - `init layer`：实际情况下，`Docker`还会在`rootfs`和`top layer`之间再挂载一个`layer`，这一个`layer`中主要包含的内容时`/etc/hosts,/etc/hostname,/etc/resolv.conf`
   - 

二、`Docker`镜像下载

1. `Docker`镜像下载流程

   ![1582621309442](C:\Users\JiangZhiheng\Documents\Typora\img\Docker\chap4\镜像下载流程.png)

   

2. `Docker Client`

   1. 解析镜像参数

      - 解析`remote`参数：解析出`registry,repository,tag`信息

   2. 配置`url.Values`

      `Docker Client`发送请求给`Docker Server`时，需要为请求配置`URL`的查询参数

   3. 解析`hostname`参数

      解析`Docker Registry`的地址信息

      `hostname,_,err := registry.ResolveRepositoryName(remote)`

3. 配置认证信息

   

4. 