一、`Docker Daemon`网络

1. `Docker Daemon`网络介绍

   - `bridge`模式

   ![bridge模式.png](http://ww1.sinaimg.cn/large/d3f19072gy1gc0oxxlxiuj20a904v0to.jpg)

2. `Docker Daemon`网络接口配置

   - `Docker Daemon`启动命令表

   | 启动`Docker Daemon`命令                      | 作用分析                                                     |
   | -------------------------------------------- | ------------------------------------------------------------ |
   | `docker -d`                                  | 启动`Docker Daemon`，使用默认`docker0`桥，不指定`CIDR`网络地址 |
   | `docker -d -b="xxx"`                         | 启动`Docker Daemon`,使用网桥`xxx`,不指定`CIDR`网络地址       |
   | `docker -d --bip="172.17.42.1"`              | 启动`Docker Daemon`,使用默认`docker0`桥，使用指定`CIDR`网络地址`"172.17.42.1"` |
   | `docker -d --bridge="xxx" --bip="10.0.0.42"` | 报错，出现兼容性问题，不能同时指定`BridgeIface`和`BridgeIP`  |
   | `docker -d --bridge="none"`                  | 启动`Docker Daemon`，不创建`Docker`网络环境                  |

3. `Docker Daemon`网络初始化

   1. `Docker Daemon`网络初始化流程

      ![DockerDaemon网络初始化流程.png](http://ww1.sinaimg.cn/large/d3f19072gy1gc0oyxc0p8j20ga0fktbk.jpg)

   2. 启动`Docker Daemon`传递`flag`参数

   3. 解析`flag`参数

   4. 预处理`flag`参数

      与`Docker Daemon`网络配置相关的参数有`EnableIptables,EnableIpForward,BridgeIP,BridgeIface,InterContainerCommunication`

      - `BridgeIP,BridgeIface`的兼容性，不可同时指定
      - `EnableIptables,InterContainerCommunication`不可同时为`false`

      判断是否要为`Docker`配置网络环境，若需要配置网络环境，则`DisableNetwork`值为`false`

   5. 确定`Docker`网络模式

      ```go
      if !config.DisableNetwork {
          job := eng.Job("init_networkdriver")
          job.Setenv...
          ...
          
          if err := jib.Run(); err != nil {
              return nil,err
          }
      }
      ```

      步骤为：

      - 创建名为`init_networkdriver`的`Job`.
      - 为`Job`配置环境变量
      - 触发执行`Job`,运行`init_network`实际完成的工作是创建`Docker`网桥
      - 若`DisableNetwork`为`true`，则说明不需要为`Docker Daemon`创建网络环境，网络模式属于`none`模式

4. 创建`Docker`网桥

   `InitDriver`函数运行流程：

   ![initDriver.jpg](http://ww1.sinaimg.cn/large/d3f19072gy1gc0ozljuimj20z91dx474.jpg)

   1. 提取环境变量
   2. 确定`Docker`网桥设备名

5. 